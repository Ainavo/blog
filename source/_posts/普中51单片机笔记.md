---
title: 普中51单片机笔记
date: 2023-08-07 23:08:38
published: false
tags:
  - 51单片机
---

- 普中 51 单片机简介

<!--more-->

## 51 单片机介绍

- CPU(运算、控制)、RAM(数据存储)、ROM(程序存储)、I/O(输入/输出设备)

## 数字电路与 C 语言

- 电平特性
  - TTL 电路和 CMOS 电路的逻辑电平关系：
    - VOH：逻辑电平 1 的输出电压
    - VOL：逻辑电平 0 的输出电压
    - VIH：逻辑电平 1 的输入电压
    - VIL：逻辑电平 0 输入电压
  - TTL 电平临界值
    - VOHmin=2.4V，VOLmax=0.4V
    - VIHmin=2.0V，VILmax=0.8V
  - CMOS 电平临界值（假设电源电压为+5V）
    - VOHmin=4.99V，VOLmax=0.01V
    - VIHmin=3.5V，VILmax=1.5V
- 二进制与十六进制
- 二进制的逻辑运算
  - `&&`:单个与运算，`&`:按位与（一串二进制用这个）
  - `||`:单个或运算，`|`:按位或运算（一串二进制用这个）
  - `!`:求反运算，`~`:按位取反（同上）
  - `^`:异或运算，相同得`0`，不同得`1`
- C51 基础知识
  - C51 扩充数据类型
    | 类型 | 长度 | 值域 | 说明 |
    | ---- | ---- | -- | - |
    | bit | 位 | 0 或 1 | 位变量声明 |
    | sbit | 位 | 0 或 1 | 特殊功能位声明 |
    | sfr | 8 位=1 字节 | 0~255 | 特殊功能寄存器声明 |
    | Sfr16 | 16 位=2 字节 | 0~65535 | Srf 的 16 数据声明 |
    | \* | 1~3 字节 | | 对象的地址 |
  - C51 运算量
    - 常量：常量是指程序在执行过程中其值不能改变的量。在 C51 中支持整型常量、浮点常量、字符型常量和字符串常量。
    - 变量：变量是指在程序运行过程中可以改变的量一个变量由变量名和变量值组成：[存储类型] 数据类型说明符 [存储器类型] 变量名 [初值]

## 51 最小系统构成

- 晶振电路
  ![晶振电路](/imgs/51单片机/晶振电路.jpg)
  - C12:旁路电容，晶振启震的一瞬间会产生电感，加电容以消除电感，电容值大小取决于晶振频率
- 复位电路
  ![复位电路](/imgs/51单片机/复位电路.jpg)
  - 按键复位或自动复位：通过 RC 复位
- 电源电路
  ![复位电路](/imgs/51单片机/复位电路.jpg)
  - 5V 转 3.3V
- 下载电路
  ![下载电路](/imgs/51单片机/下载电路.jpg)
  - CH340：USB 转 TTL 与单片机串口相连

## 点亮第一个 LED

- 51 单片机 GPIO 介绍：GPIO（general purpose input output）是通用输入输出端口的简称，可以通过软件来控制其输入和输出
  - 电源引脚：VCC、GND、VDD
  - 晶振引脚
  - 复位引脚
  - 下载引脚
  - GPIO 引脚
- LED 简介
- 硬件设计
- 软件设计
- 实验现象

## 中断

- 中断概念：中断是单片机具有对外部或内部随机发生时间实时处理而设置的。优点：分时操作、实时响应、可靠性高
- 中断结构
  ![中断结构](\imgs\51单片机\中断结构.png)
- 中断寄存器
- 外部中断实验
  - 外部中断介绍
  - 外部中断配置
    - 中断源有中断请求
    - 中断源的中断允许位为 1
    - CPU 开中断（即 EA=1）
    ```C
      EA=1; // 打开总中断开关
      EX0=1; // 打开外部中断0
      IT0=0/1; //设置外部中断的触发方式
      void int0() interrupt 0
      {
        // 中断代码
      }
    ```
  - 硬件设计/软件编程

## 定时器

- CPU 时序周期相关知识
  - 振荡周期：晶振倒数
  - 状态周期：2 个振荡周期
  - 机器周期：12 个震荡周期=1us
  - 指令周期：1~4us
- 定时器原理：高 8 位和低 8 位组成
- 定时计数器结构
- 定时计数器工作方式
- 定时计数器配置
- 硬件设计/软件编程

## 串口通信

- 串口通信与并口通信
  - 串行通信-->依次传输
  - 并行通信-->同时传输
- 异步通信与同步通信
  - 异步通信：发出设备和接收设备使用各自的时钟，各字符间有整数倍间隔。一个字符帧包含 11 位。
  - 同步通信：发送和接收时钟同步，外同步：发送时钟控制接收；自同步：数据+时钟控制接收。
- 单工&半双工&全双工通信
  - 单工：单向方向
  - 半双工：分时发送接收
  - 全双工：可同时发送和接收
- 通信数率(bit/s)
  - 波特率（每秒多少码元）；比特率（每秒多少位）bps
- 串口通信简介
  - 接口标准和通信协议
    - 接口标准
    - 通信协议：RS232 遵循`96-N-8-1`：{`96`：9600, `N`:无校验位，`8`：传输的数据位，`1`：停止位}
  - 串口内部结构
    ![串口内部结构](\imgs\51单片机\串口内部结构.png)
  - 串口相关寄存器
  - ![串口相关寄存器](\imgs\51单片机\串口相关寄存器.png)
  - 串口工作方式：
    - 方式 1
    - 方式 2
    - 方式 3
  - 计算波特率
    - 方式 0 波特率：fosc/12
    - 方式 2 的波特率:(2SMOD/64)\*fosc
    - 方式 1 的波特率:(2SMOD/32)\*(T1 溢出率)
    - 方式 3 的波特率:(2SMOD/32)\*(T1 溢出率)
    - 其中 T1 溢出率=fosc/{12\*[256-(TH1)]}
  - 串口配置步骤
    - 初始化步骤
      - 确定 T1 的工作方式(TMOD 寄存器)
      - 确定串口工作方式（SCON 寄存器）
      - 确定 T1 初值（设定波特率），装载 TH1、TL1
      - 启动 T1（TCON 中的 TR1 位）
      - 如果使用中断，需要开启串口中断控制位（IE 寄存器）
    ```C
      void uart_init(u8 baud)
      {
        TMOD |= 0x20; //设置计数器工作方式2
        SCON = 0x50; //设置为工作方式1
        PCON = 0x80; //波特率加倍
        TH1 = baud; //计数器初识值设置
        TL1 = baud;
        ES=1; //打开接收中断
        EA=1; //打开总中断
        TR1=1; //打开计数器
      }
    ```
  - 硬件设计/软件编程

## $I^{2}C$-EEPROM 协议

- $I^{2}C$ 物理层介绍
- $I^{2}C$ 协议层
  - 起始和停止信号
  - 应答信号
  - 总线寻址方式
  - 数据传输
- AT24C02 介绍
- 硬件介绍
- 软件介绍
  - 创建多文件工程
  - $I^{2}C$ 起始和停止信号
  - $I^{2}C$ 等待应答信号
  - $I^{2}C$ 读写字节函数
    - 写字节函数
    - 读字节函数
    - 主函数

## AD 数模转换器

- ADC 数模转换
  - ADC 简介
  - ADC 转换步骤
  - ADC 转换原理
    - 逐次逼近型
    - 双积分型
  - XPT2046 芯片功能介绍
  - 硬件设计
  - 软件编程
    - 写函数
    - 读函数
    - 读 AD 转换数据函数
    - 主函数
- DAC 数模转换
  - DAC 简介
  - DAC 工作原理
  - PWM 介绍
  - 主函数

## 参考文献

## 补充

### 原理图相关

- 管脚名相同则相连
- 排阻：阻值的选取，通过发光二极管选择(3mA~10mA)
- 锁存器：
